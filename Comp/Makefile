# Makefile
#
# Generated by phxrpc_pb2server from comp.proto
#
#

include /usr/local/etc/phxrpc/phxrpc.mk

LDFLAGS := -L$(PHXRPC_ROOT)/lib -lphxrpc $(LDFLAGS) 

# choose to use boost for network
#LDFLAGS := $(PLUGIN_BOOST_LDFLAGS) $(LDFLAGS)

SVR_OBJS = comp.pb.o \
		phxrpc_comp_service.o \
		phxrpc_comp_dispatcher.o \
		comp_server_config.o \
		comp_main.o

CLI_OBJS = comp.pb.o \
		comp_client.o \
		comp_client_uthread.o \
		phxrpc_comp_stub.o

TARGETS = libcomp_client.a comp1 comp2 comp3 comp4 comp_tool_main

all: $(TARGETS)

comp1: $(SVR_OBJS) comp_service_impl_1.o
	$(LINKER) $^ -L../AdminServer/ -ladmin_client $(LDFLAGS) -o $@

comp2: $(SVR_OBJS) comp_service_impl_2.o
	$(LINKER) $^ -L../AdminServer/ -ladmin_client $(LDFLAGS) -o $@

comp3: $(SVR_OBJS) comp_service_impl_3.o
	$(LINKER) $^ -L../AdminServer/ -ladmin_client $(LDFLAGS) -o $@

comp4: $(SVR_OBJS) comp_service_impl_4.o
	$(LINKER) $^ -L../AdminServer/ -ladmin_client $(LDFLAGS) -o $@

libcomp_client.a: $(CLI_OBJS)
	$(AR) $@ $^

comp_tool_main: phxrpc_comp_tool.o comp_tool_impl.o comp_tool_main.o
	$(LINKER) $^ -L. -lcomp_client $(LDFLAGS) -o $@

########## message ##########

comp.pb.cc: comp.pb.h

comp.pb.h: comp.proto
	$(PROTOBUF_ROOT)/bin/protoc -I$(PROTOBUF_ROOT)/include --cpp_out=. -I$(PHXRPC_ROOT) -I. $^

########## client ##########

phxrpc_comp_stub.cpp: phxrpc_comp_stub.h
phxrpc_comp_stub.o: phxrpc_comp_stub.h
comp_client.cpp: phxrpc_comp_stub.h
comp_client.o: phxrpc_comp_stub.h
comp_client_uthread.cpp: phxrpc_comp_stub.h
comp_client_uthread.o: phxrpc_comp_stub.h

phxrpc_comp_stub.h: comp.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2client $(PBFLAGS) -f $^ -d . -p mqtt

########## service ##########

phxrpc_comp_service.cpp: phxrpc_comp_service.h
phxrpc_comp_service.o: phxrpc_comp_service.h
comp_service_impl_1.o: comp_service_impl_1.cpp
comp_service_impl_2.o: comp_service_impl_2.cpp
comp_service_impl_3.o: comp_service_impl_3.cpp
comp_service_impl_4.o: comp_service_impl_4.cpp
phxrpc_comp_dispatcher.cpp: phxrpc_comp_service.h
phxrpc_comp_dispatcher.o: phxrpc_comp_service.h

phxrpc_comp_service.h: comp.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2service $(PBFLAGS) -f $^ -d . -u -p mqtt

########## tool ##########

phxrpc_comp_tool.cpp: phxrpc_comp_tool.h
phxrpc_comp_tool.o: phxrpc_comp_tool.h
comp_tool_impl.cpp: phxrpc_comp_tool.h
comp_tool_impl.o: phxrpc_comp_tool.h
comp_tool_main.cpp: phxrpc_comp_tool.h
comp_tool_main.o: phxrpc_comp_tool.h

phxrpc_comp_tool.h: comp.proto
	$(PHXRPC_ROOT)/codegen/phxrpc_pb2tool $(PBFLAGS) -f $^ -d . -p mqtt

clean:
	@($(RM) $(TARGETS))
	@($(RM) *.o)
	@($(RM) phxrpc_*)
	@($(RM) *.pb.*)

